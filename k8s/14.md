# LAB14

## Components
* The Prometheus Operator
These are kubernetes resources that make it easy to deploy and configure prometheus, alertmanager, and other monitoring components.
* Highly available Prometheus
Prometheus is a tool used to collect and store metrics in a database from different applications.
* Highly available Alertmanager
Alertmanager user to group and route alerts to appropriate recipient integrations.
* Prometheus node-exporter
Exports machine metrics for kubernetes.
* Grafana
A tool for visualizing various metrics.

## Outputs

`kubectl get po,sts,svc,pvc,cm` - command prints all pods(po), services(svc), statefulsets(sts), persistant volumes(pvc), and configmaps(cm) in a default namespace.

```
┌──(kali㉿kali)-[~/repos/inno_devops]
└─$ minikube kubectl -- get po,sts,svc,pvc,cm
NAME                                                           READY   STATUS    RESTARTS   AGE
pod/alertmanager-kube-prometheus-stack-alertmanager-0          2/2     Running   1          48s
pod/kube-prometheus-stack-grafana-748d76597d-fgx42             3/3     Running   0          75s
pod/kube-prometheus-stack-kube-state-metrics-579bf68b5-d2lnx   1/1     Running   0          75s
pod/kube-prometheus-stack-operator-55b585746-8pk8b             1/1     Running   0          75s
pod/kube-prometheus-stack-prometheus-node-exporter-4ngsq       1/1     Running   0          75s
pod/prometheus-kube-prometheus-stack-prometheus-0              1/2     Running   0          47s
pod/python-app-0                                               1/1     Running   0          3m49s
pod/python-app-1                                               1/1     Running   0          3m49s
pod/python-app-2                                               1/1     Running   0          3m49s

NAME                                                               READY   AGE
statefulset.apps/alertmanager-kube-prometheus-stack-alertmanager   1/1     48s
statefulset.apps/prometheus-kube-prometheus-stack-prometheus       0/1     47s
statefulset.apps/python-app                                        3/3     3m49s

NAME                                                     TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
service/alertmanager-operated                            ClusterIP      None             <none>        9093/TCP,9094/TCP,9094/UDP   48s
service/kube-prometheus-stack-alertmanager               ClusterIP      10.105.170.254   <none>        9093/TCP                     75s
service/kube-prometheus-stack-grafana                    ClusterIP      10.106.64.146    <none>        80/TCP                       75s
service/kube-prometheus-stack-kube-state-metrics         ClusterIP      10.102.204.190   <none>        8080/TCP                     75s
service/kube-prometheus-stack-operator                   ClusterIP      10.104.196.27    <none>        443/TCP                      75s
service/kube-prometheus-stack-prometheus                 ClusterIP      10.100.40.113    <none>        9090/TCP                     75s
service/kube-prometheus-stack-prometheus-node-exporter   ClusterIP      10.99.109.128    <none>        9100/TCP                     75s
service/kubernetes                                       ClusterIP      10.96.0.1        <none>        443/TCP                      13d
service/prometheus-operated                              ClusterIP      None             <none>        9090/TCP                     47s
service/python-app                                       LoadBalancer   10.110.28.40     <pending>     80:30565/TCP                 3m49s

NAME                                                   STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/persistent-volume-python-app-0   Bound    pvc-4caf47f4-f610-40ef-babf-a463dee4a9e4   128Mi      RWO            standard       3m49s
persistentvolumeclaim/persistent-volume-python-app-1   Bound    pvc-d52bdb61-503b-4b75-a34f-477b93020970   128Mi      RWO            standard       3m49s
persistentvolumeclaim/persistent-volume-python-app-2   Bound    pvc-b553f946-0759-4257-8472-9f84da526e05   128Mi      RWO            standard       3m49s

NAME                                                                DATA   AGE
configmap/kube-prometheus-stack-alertmanager-overview               1      75s
configmap/kube-prometheus-stack-apiserver                           1      75s
configmap/kube-prometheus-stack-cluster-total                       1      75s
configmap/kube-prometheus-stack-controller-manager                  1      75s
configmap/kube-prometheus-stack-etcd                                1      75s
configmap/kube-prometheus-stack-grafana                             1      75s
configmap/kube-prometheus-stack-grafana-config-dashboards           1      75s
configmap/kube-prometheus-stack-grafana-datasource                  1      75s
configmap/kube-prometheus-stack-grafana-overview                    1      75s
configmap/kube-prometheus-stack-k8s-coredns                         1      75s
configmap/kube-prometheus-stack-k8s-resources-cluster               1      75s
configmap/kube-prometheus-stack-k8s-resources-namespace             1      75s
configmap/kube-prometheus-stack-k8s-resources-node                  1      75s
configmap/kube-prometheus-stack-k8s-resources-pod                   1      75s
configmap/kube-prometheus-stack-k8s-resources-workload              1      75s
configmap/kube-prometheus-stack-k8s-resources-workloads-namespace   1      75s
configmap/kube-prometheus-stack-kubelet                             1      75s
configmap/kube-prometheus-stack-namespace-by-pod                    1      75s
configmap/kube-prometheus-stack-namespace-by-workload               1      75s
configmap/kube-prometheus-stack-node-cluster-rsrc-use               1      75s
configmap/kube-prometheus-stack-node-rsrc-use                       1      75s
configmap/kube-prometheus-stack-nodes                               1      75s
configmap/kube-prometheus-stack-nodes-darwin                        1      75s
configmap/kube-prometheus-stack-persistentvolumesusage              1      75s
configmap/kube-prometheus-stack-pod-total                           1      75s
configmap/kube-prometheus-stack-prometheus                          1      75s
configmap/kube-prometheus-stack-proxy                               1      75s
configmap/kube-prometheus-stack-scheduler                           1      75s
configmap/kube-prometheus-stack-workload-total                      1      75s
configmap/kube-root-ca.crt                                          1      13d
configmap/prometheus-kube-prometheus-stack-prometheus-rulefiles-0   29     48s
configmap/python-app-config                                         1      3m49s
```

## Init

```
┌──(kali㉿kali)-[~/repos/inno_devops/k8s]
└─$ cat lab14-init.yml    
apiVersion: v1
kind: Pod
metadata:
  name: init-demo
spec:
  containers:
  - name: nginx
    image: nginx
    ports:
    - containerPort: 80
    volumeMounts:
    - name: workdir
      mountPath: /usr/share/nginx/html
  # These containers are run during pod initialization
  initContainers:
  - name: install
    image: busybox:1.28
    command:
    - wget
    - "-O"
    - "/work-dir/index.html"
    - http://info.cern.ch
    volumeMounts:
    - name: workdir
      mountPath: "/work-dir"
  dnsPolicy: Default
  volumes:
  - name: workdir
    emptyDir: {}
```

```
┌──(kali㉿kali)-[~/repos/inno_devops]
└─$ kubectl exec pod/init-demo -- cat /usr/share/nginx/html/index.html
Defaulted container "nginx" out of: nginx, install (init)
<html><head></head><body><header>
<title>http://info.cern.ch</title>
</header>

<h1>http://info.cern.ch - home of the first website</h1>
<p>From here you can:</p>
<ul>
<li><a href="http://info.cern.ch/hypertext/WWW/TheProject.html">Browse the first website</a></li>
<li><a href="http://line-mode.cern.ch/www/hypertext/WWW/TheProject.html">Browse the first website using the line-mode browser simulator</a></li>
<li><a href="http://home.web.cern.ch/topics/birth-web">Learn about the birth of the web</a></li>
<li><a href="http://home.web.cern.ch/about">Learn about CERN, the physics laboratory where the web was born</a></li>
</ul>
</body></html>
```
